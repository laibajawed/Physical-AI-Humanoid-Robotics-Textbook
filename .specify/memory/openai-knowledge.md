# Required packages:
# pip install openai-agents
# pip install python-dotenv

from agents import Agent, Runner, AsyncOpenAI, OpenAIChatCompletionsModel, RunConfig, function_tool
from dotenv import load_dotenv
import os

# Load environment variables from .env file into system environment
load_dotenv()

# Get the API key from environment variables securely
gemini_api_key = os.getenv("GEMINI_API_KEY")
print(gemini_api_key)

# If API key is missing, stop the program and show error
if not gemini_api_key:
    raise ValueError("GEMINI_API_KEY is not set. Please ensure it is defined in your .env file.")

# Create an asynchronous API client with your API key and base URL
# Async means it can handle other tasks while waiting for response
external_client = AsyncOpenAI(
    api_key=gemini_api_key,
    base_url="https://generativelanguage.googleapis.com/v1beta/openai/",
)

# Define which AI model to use and attach the client
model = OpenAIChatCompletionsModel(
    model="gemini-2.0-flash",
    openai_client=external_client
)

# Configuration for running the agent
# Includes model info, provider (client), and turning off tracing for privacy
config = RunConfig(
    model=model,
    model_provider=external_client,
    tracing_disabled=True  # disables storing run details on server for privacy
)

# Create an agent with a name and instructions what it should do
RAG_Retrieval = Agent(
    name='RAG_Retrieval_Agent',
    instructions="""You are a RAG Retrieval Agent,
    Your task is to inject context from vector search results.""",
    tools=[hello, add] //Just for example tool calling
)

# Run the agent synchronously (wait till it finishes) with given input and config
response = Runner.run_sync(
    RAG_Retrieval,
    input='You are a RAG Retrieval Agent. Your task is to inject context from vector search results...',
    run_config=config
)

#Tool calling reference is given below
# Print the final output generated by the AI agent
print(response.final_output)

# tools implementation 

@function_tool
def hello():
    """
    say hello
    """
    return "hello"
@function_tool
def add(a: int , b:int) -> int:
    """
    return the sum of 2 numbers

    Args :
        a:int
        b:int
        c:res
    """
    print("Add Tool has been called")
    return a+b