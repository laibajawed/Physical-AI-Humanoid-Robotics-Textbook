openapi: 3.0.3
info:
  title: Better Auth API
  description: |
    Authentication endpoints provided by Better Auth on Vercel Serverless Functions.
    These endpoints are auto-generated by Better Auth and mounted at `/api/auth/*`.
  version: 1.0.0
  contact:
    name: Authentication Integration

servers:
  - url: https://physical-ai-robotics-book.vercel.app
    description: Production (Vercel)
  - url: http://localhost:3000
    description: Development

paths:
  /api/auth/sign-up/email:
    post:
      operationId: signUpEmail
      summary: Register new user
      description: Create a new user account with email and password
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'
            example:
              name: "John Doe"
              email: "john@example.com"
              password: "securePassword123"
      responses:
        '200':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
          headers:
            Set-Cookie:
              description: Session cookie
              schema:
                type: string
        '400':
          description: Validation error or user already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
              examples:
                userExists:
                  summary: Email already registered
                  value:
                    error:
                      code: "USER_ALREADY_EXISTS"
                      message: "An account with this email already exists"
                weakPassword:
                  summary: Password too short
                  value:
                    error:
                      code: "WEAK_PASSWORD"
                      message: "Password must be at least 8 characters"

  /api/auth/sign-in/email:
    post:
      operationId: signInEmail
      summary: Sign in user
      description: Authenticate user with email and password
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignInRequest'
            example:
              email: "john@example.com"
              password: "securePassword123"
              rememberMe: true
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
          headers:
            Set-Cookie:
              description: Session cookie with JWT
              schema:
                type: string
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
              example:
                error:
                  code: "INVALID_CREDENTIALS"
                  message: "Invalid email or password"

  /api/auth/sign-out:
    post:
      operationId: signOut
      summary: Sign out user
      description: Terminate the current session
      tags:
        - Authentication
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Successfully signed out
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
          headers:
            Set-Cookie:
              description: Cookie deletion header
              schema:
                type: string

  /api/auth/session:
    get:
      operationId: getSession
      summary: Get current session
      description: Retrieve the current user's session and profile data
      tags:
        - Session
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Session data (or null if not authenticated)
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/AuthResponse'
                  - type: 'null'
              examples:
                authenticated:
                  summary: User is signed in
                  value:
                    user:
                      id: "usr_abc123"
                      name: "John Doe"
                      email: "john@example.com"
                      emailVerified: false
                      image: null
                      createdAt: "2025-12-23T10:00:00Z"
                    session:
                      id: "ses_xyz789"
                      expiresAt: "2025-12-24T10:00:00Z"
                unauthenticated:
                  summary: No active session
                  value: null

  /api/auth/jwks:
    get:
      operationId: getJwks
      summary: Get JSON Web Key Set
      description: |
        Returns the public keys used to verify JWT tokens.
        FastAPI backend uses this endpoint to validate tokens.
      tags:
        - JWKS
      responses:
        '200':
          description: JWKS document
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JwksResponse'
              example:
                keys:
                  - kty: "OKP"
                    crv: "Ed25519"
                    x: "base64_encoded_public_key"
                    kid: "key-1"
                    use: "sig"
                    alg: "EdDSA"

components:
  schemas:
    SignUpRequest:
      type: object
      required:
        - name
        - email
        - password
      properties:
        name:
          type: string
          description: User's display name
          minLength: 1
          maxLength: 255
          example: "John Doe"
        email:
          type: string
          format: email
          description: User's email address
          example: "john@example.com"
        password:
          type: string
          format: password
          description: Account password
          minLength: 8
          maxLength: 128
          example: "securePassword123"
        image:
          type: string
          format: uri
          description: Optional profile image URL
          nullable: true
        callbackURL:
          type: string
          format: uri
          description: URL to redirect after signup
          nullable: true

    SignInRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User's email address
          example: "john@example.com"
        password:
          type: string
          format: password
          description: Account password
          example: "securePassword123"
        rememberMe:
          type: boolean
          description: |
            If true, session lasts 30 days.
            If false, session lasts 1 hour.
          default: false
        callbackURL:
          type: string
          format: uri
          description: URL to redirect after signin
          nullable: true

    AuthResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        session:
          $ref: '#/components/schemas/Session'

    User:
      type: object
      properties:
        id:
          type: string
          description: Unique user identifier (UUID)
          example: "usr_abc123"
        name:
          type: string
          description: User's display name
          example: "John Doe"
        email:
          type: string
          format: email
          description: User's email address
          example: "john@example.com"
        emailVerified:
          type: boolean
          description: Whether email is verified
          example: false
        image:
          type: string
          format: uri
          nullable: true
          description: Profile image URL
        createdAt:
          type: string
          format: date-time
          description: Account creation timestamp
          example: "2025-12-23T10:00:00Z"

    Session:
      type: object
      properties:
        id:
          type: string
          description: Session identifier
          example: "ses_xyz789"
        expiresAt:
          type: string
          format: date-time
          description: Session expiration time
          example: "2025-12-24T10:00:00Z"

    AuthError:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              description: Error code
              enum:
                - USER_ALREADY_EXISTS
                - INVALID_CREDENTIALS
                - WEAK_PASSWORD
                - INVALID_EMAIL
                - RATE_LIMITED
                - SERVICE_UNAVAILABLE
            message:
              type: string
              description: Human-readable error message

    JwksResponse:
      type: object
      properties:
        keys:
          type: array
          items:
            type: object
            properties:
              kty:
                type: string
                description: Key type
                example: "OKP"
              crv:
                type: string
                description: Curve (for EdDSA)
                example: "Ed25519"
              x:
                type: string
                description: Public key (base64url)
              kid:
                type: string
                description: Key ID
              use:
                type: string
                enum: ["sig"]
                description: Key usage
              alg:
                type: string
                description: Algorithm
                example: "EdDSA"

  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: better-auth.session_token
      description: Session JWT stored in cookie
